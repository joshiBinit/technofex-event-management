<div class="p-4">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold mb-4">Event List</h1>
    @if ((role$ | async) === 'admin') {
    <button
      mat-raised-button
      color="accent"
      class="rounded-lg"
      (click)="onAddEvent()"
    >
      + Add New Event
    </button>
    }
  </div>

  <!-- Loading message -->
  <p class="text-gray-600" *ngIf="loading$ | async">Loading events...</p>
  @if (loading$ | async) {
  <p class="text-gray-600">Loading events...</p>
  }

  <app-search-component
    [data]="allEvents"
    [searchFields]="searchFields"
    [placeholder]="'Search by title, category, location...'"
    (filteredData)="onFilteredDataChanged($event)"
  >
  </app-search-component>


  <div class="overflow-x-auto">
    <table
      mat-table
      [dataSource]="displayedEvents"
      class="mat-elevation-z4 w-full rounded-lg overflow-hidden"
    >
      <!-- Title Column -->
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2">Title</th>
        <td mat-cell *matCellDef="let event" class="px-4 py-2">
          {{ event.title }}
        </td>
      </ng-container>

      <!-- Category Column -->
      <ng-container matColumnDef="category">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2">Category</th>
        <td mat-cell *matCellDef="let event" class="px-4 py-2">
          {{ event.category }}
        </td>
      </ng-container>

      <!-- Date Column -->
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2">Date</th>
        <td mat-cell *matCellDef="let event" class="px-4 py-2">
          {{ event.date }} {{ event.time }}
        </td>
      </ng-container>

      <!-- Location Column -->
      <ng-container matColumnDef="location">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2">Location</th>
        <td mat-cell *matCellDef="let event" class="px-4 py-2">
          {{ event.location }}
        </td>
      </ng-container>

      <!-- Tickets Column -->
      <ng-container matColumnDef="tickets">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2">Tickets</th>
        <td mat-cell *matCellDef="let event" class="px-4 py-2">
          {{ event.totalTickets }}
        </td>
      </ng-container>

      <!-- Available Tickets Column -->
      <ng-container matColumnDef="availableTickets">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2">
          Available Tickets
        </th>
        <td mat-cell *matCellDef="let event" class="px-4 py-2">
          {{ event.availableTickets }}
        </td>
      </ng-container>

      <!-- Price Column -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2">Price</th>
        <td mat-cell *matCellDef="let event" class="px-4 py-2">
          ${{ event.price }}
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="px-4 py-2">Actions</th>
        <td mat-cell *matCellDef="let event" class="px-4 py-2">
          <!-- Admin Buttons -->
          <ng-container *ngIf="(role$ | async) === 'admin'">
            <button
              mat-raised-button
              color="primary"
              class="rounded-lg mr-2"
              (click)="onUpdateEvent(event.id)"
            >
              Update
            </button>
            <button
              mat-raised-button
              color="warn"
              class="rounded-lg"
              (click)="onDeleteEvent(event.id)"
            >
              Delete
            </button>
          </ng-container>

          <!-- User Button -->
          <ng-container *ngIf="(role$ | async) === 'user'">
            <button
              mat-raised-button
              color="primary"
              class="rounded-lg"
              (click)="onBookNow(event)"
            >
              Book Now
            </button>
          </ng-container>
        </td>
      </ng-container>

      <!-- Header and Row Declarations -->
      <tr mat-header-row *matHeaderRowDef="getDisplayedColumns() | async"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: getDisplayedColumns() | async"
      ></tr>
    </table>
    
    <!-- No Results Message -->
    <div
      *ngIf="displayedEvents.length === 0 && !(loading$ | async)"
      class="p-4 text-center text-gray-500"
    >
      <p>No events found matching your search criteria.</p>
    </div>

    <!-- Pagination Component -->
    <app-pagination
    *ngIf="displayedEvents.length === 0 && !(loading$ | async)"

      #pagination
      [data]="allEvents"
      [showFirstLastButtons]="true"
      (page)="onPageChange($event)"
      (paginatedData)="onPaginatedDataChanged($event)"
      class="mt-4"
    >
    </app-pagination>
  </div>
</div>
